import{q as C,f as g}from"./shared-BaN-rwBn.js";const m=C(),t=e=>document.getElementById(e),c=t("shell"),$=t("phase-pill"),s=t("live-indicator"),L=t("director-line"),b=t("challenger-line"),T=t("pressure-track"),k=t("pressure-fill"),d=t("pressure-text"),v=t("current-performance"),q=t("queue-list"),P=t("command-history"),M=t("activity-feed"),F=t("open-menu");let x=0;const u=(e,r,a,i)=>{if(e.innerHTML="",!r.length){const l=document.createElement("li");l.textContent=a,e.appendChild(l);return}r.forEach(l=>{const o=document.createElement("li");o.textContent=i(l),e.appendChild(o)})},w=()=>{c.classList.remove("flash"),c.offsetWidth,c.classList.add("flash"),setTimeout(()=>c.classList.remove("flash"),700)},B=e=>{var l,o,h,p,f,E,y;$.textContent=e.isLive?"LIVE":"ПРЕДПРОДАКШН",e.isLive?(s.style.opacity="1",s.lastElementChild.textContent="LIVE"):(s.style.opacity="0.65",s.lastElementChild.textContent="PRE"),L.textContent=`Режиссёр: ${((l=e.director)==null?void 0:l.name)||"Casting..."} (${((o=e.director)==null?void 0:o.total)||0} тк)`,b.textContent=`Претендент: ${((h=e.challenger)==null?void 0:h.name)||"None"} (${((p=e.challenger)==null?void 0:p.total)||0} тк)`;const r=e.pressure||{},a=Math.max(0,Math.min(100,Number(r.percent||0)));k.style.width=`${a}%`,T.classList.toggle("critical",!!(r.isCritical&&((f=e.challenger)!=null&&f.id))),!((E=e.director)!=null&&E.id)||!((y=e.challenger)!=null&&y.id)?d.textContent="Ожидаем соперника":r.isCritical?d.textContent=`Критично: разрыв < ${e.overtakeMargin} тк`:d.textContent=`До перехвата осталось: ${r.neededToOvertake} тк`,e.currentPerformance?v.textContent=`${e.currentPerformance.categoryTitle} / ${e.currentPerformance.label} (${g(e.currentPerformance.remainingMs)})`:v.textContent="Ожидание",u(q,(e.queue||[]).slice(0,6),"Очередь пуста",n=>`${n.categoryTitle}: ${n.label} (${n.issuedByName})`),u(P,(e.commandHistory||[]).slice(0,6),"Команд пока нет",n=>`${n.categoryTitle}: ${n.label}`),u(M,(e.activityFeed||[]).slice(0,8),"Активность скоро появится",n=>n.text);const i=Number(e.overlayFlashAt||0);i&&i!==x&&(x=i,w())};F.addEventListener("click",()=>{m.makeRequest("v1.ext.menu.open",null)});m.subscribe("v1.ext.whispered",e=>{!e||typeof e!="object"||e.type==="director.state"&&B(e)});const I=async()=>{await m.makeRequest("v1.ext.whisper",{data:{type:"director.state.request"}})};I();
