import{q as m,n as t,D as c}from"./shared-BaN-rwBn.js";const o=m(),a=e=>document.getElementById(e),n={preproductionGoal:a("preproduction-goal"),overtakeMargin:a("overtake-margin"),minTenureSec:a("min-tenure-sec"),commandDurationSec:a("command-duration-sec"),commandCooldownSec:a("command-cooldown-sec"),tipMenuRefreshSec:a("tipmenu-refresh-sec"),fallbackTipMenu:a("fallback-tip-menu"),backendUrl:a("backend-url"),backendApiKey:a("backend-api-key")},d=a("preview-goal"),s=a("preview-margin"),p=a("preview-tenure"),v=a("preview-command"),S=a("status"),u=()=>({preproductionGoal:Number(n.preproductionGoal.value),overtakeMargin:Number(n.overtakeMargin.value),minTenureSec:Number(n.minTenureSec.value),commandDurationSec:Number(n.commandDurationSec.value),commandCooldownSec:Number(n.commandCooldownSec.value),tipMenuRefreshSec:Number(n.tipMenuRefreshSec.value),fallbackTipMenu:String(n.fallbackTipMenu.value||""),backendUrl:String(n.backendUrl.value||"").trim(),backendApiKey:String(n.backendApiKey.value||"").trim()}),i=e=>{n.preproductionGoal.value=String(e.preproductionGoal),n.overtakeMargin.value=String(e.overtakeMargin),n.minTenureSec.value=String(e.minTenureSec),n.commandDurationSec.value=String(e.commandDurationSec),n.commandCooldownSec.value=String(e.commandCooldownSec),n.tipMenuRefreshSec.value=String(e.tipMenuRefreshSec),n.fallbackTipMenu.value=e.fallbackTipMenu,n.backendUrl.value=e.backendUrl,n.backendApiKey.value=e.backendApiKey},r=()=>{const e=t(u());d.textContent=`Goal ${e.preproductionGoal}`,s.textContent=`Margin ${e.overtakeMargin}`,p.textContent=`Tenure ${e.minTenureSec}s`,v.textContent=`Command ${e.commandDurationSec}s / ${e.commandCooldownSec}s cd`},k=async()=>{try{const{settings:e}=await o.makeRequest("v1.model.ext.settings.get",null),l=t(e||c);i(l),r()}catch{const e=t(c);i(e),r()}};o.subscribe("v1.model.ext.settings.set.requested",async()=>{const e=t(u());await o.makeRequest("v1.model.ext.settings.set",{settings:e,isError:!1}),await o.makeRequest("v1.ext.whisper",{data:{type:"director.settings.updated"}}),S.textContent="Сохранено. Background получил обновления."});Object.values(n).forEach(e=>{e.addEventListener("input",r)});k();
